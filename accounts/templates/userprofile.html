{% extends "base.html" %}

{% block title %}{{ profile_user.username }}'s Profile - Library Application{% endblock %}

{% block content %}
<a href="{% url 'accounts:userlist' %}" class="btn btn-secondary btn-sm mt-3">← Back to Users</a>

<div class="card mt-3">
    <div class="card-body text-center">
        <img src="{{ profile_user.avatar.url }}" alt="{{ profile_user.username }}" class="profile-avatar">
        <h2 class="card-title">{{ profile_user.username }}'s Profile</h2>
        <p class="card-text">
            {% if profile_user.user_type == 'librarian' %}
            <span class="badge badge-primary">Librarian</span>
            {% else %}
            <span class="badge badge-success">Reader</span>
            {% endif %}
        </p>
        <p class="card-text"><strong>Joined:</strong> {{ profile_user.date_joined|date:"M d, Y" }}</p>
    </div>
</div>

{% if profile_user.user_type == 'reader' %}
<h3 class="mt-4">Books Read</h3>
{% if read_books %}
<table class="table table-striped table-hover mt-3">
    <thead class="thead-dark">
        <tr>
            <th scope="col">ID</th>
            <th scope="col">Title</th>
            <th scope="col">Author</th>
            <th scope="col">Genre</th>
            <th scope="col">Year</th>
            <th scope="col">Rating</th>
            <th scope="col">Read On</th>
        </tr>
    </thead>
    <tbody>
        {% for read_book in read_books %}
        <tr>
            <th scope="row">{{forloop.counter}}</th>
            <td>{{read_book.book.title}}</td>
            <td>{{read_book.book.author}}</td>
            <td><span class="badge badge-info">{{read_book.book.get_genre_display}}</span></td>
            <td>{{read_book.book.year}}</td>
            <td>
                <span class="text-warning">
                    {% for i in "12345" %}
                        {% if forloop.counter <= read_book.rating %}★{% else %}☆{% endif %}
                    {% endfor %}
                </span>
            </td>
            <td>{{read_book.date_added|date:"M d, Y"}}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% else %}
<div class="alert alert-info mt-3" role="alert">
    {{ profile_user.username }} hasn't read any books yet.
</div>
{% endif %}
{% else %}
<div class="alert alert-info mt-4" role="alert">
    {{ profile_user.username }} is a librarian and doesn't track reading history.
</div>
{% endif %}
{% endblock %}